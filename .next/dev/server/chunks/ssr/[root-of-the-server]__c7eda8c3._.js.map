{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 28, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Alexander/webmizu/apps/adminFE/src/lib/api/client.ts"],"sourcesContent":["import { Session } from \"@supabase/supabase-js\";\r\n\r\nconst BACKEND_URL = process.env.NEXT_PUBLIC_BACKEND_URL || \"http://localhost:3000/api/v1\";\r\n\r\ninterface CreateTechnicianDTO {\r\n  name: string;\r\n  phone?: string;\r\n  photo_url?: string;\r\n  notes?: string;\r\n}\r\n\r\ntype ApiOptions = RequestInit & {\r\n  token?: string;\r\n};\r\n\r\n// We can rely on Types from @/src/types, but here we define DTOs if needed for generics\r\nimport { CreateProductDTO, CreateCustomerDTO, UpdateCustomerDTO } from \"@/src/types\";\r\n\r\nasync function fetchApi<T>(path: string, options: ApiOptions = {}): Promise<T> {\r\n  const { token, headers, ...init } = options;\r\n  \r\n  const reqHeaders = new Headers(headers);\r\n  reqHeaders.set(\"Content-Type\", \"application/json\");\r\n  \r\n  if (token) {\r\n    reqHeaders.set(\"Authorization\", `Bearer ${token}`);\r\n  }\r\n\r\n  const response = await fetch(`${BACKEND_URL}${path}`, {\r\n    ...init,\r\n    headers: reqHeaders,\r\n  });\r\n\r\n  const data = await response.json();\r\n  \r\n  if (!response.ok) {\r\n    // Check for message in various locations: data.message, data.error.message, data.error\r\n    const msg = data.message || data.error?.message || (typeof data.error === 'string' ? data.error : \"An API error occurred\");\r\n    throw new Error(msg);\r\n  }\r\n\r\n  return data; // Assuming { success: true, data: T } is unwrapped by caller or we return full response?\r\n  // User spec: standard response envelope. Ideally we return the whole envelope or just data?\r\n  // Let's return the full envelope for now to match current return types if any.\r\n}\r\n\r\n// Factory to create a client bound to a session\r\nexport const createApiClient = (session: Session | null) => {\r\n  const token = session?.access_token;\r\n\r\n  return {\r\n    auth: {\r\n      getMe: async () => {\r\n        return fetchApi(\"/auth/me\", { token });\r\n      }\r\n    },\r\n    technicians: {\r\n      list: async (params?: { page?: number; limit?: number; q?: string }) => {\r\n        const searchParams = new URLSearchParams();\r\n        if (params?.page) searchParams.append(\"page\", params.page.toString());\r\n        if (params?.limit) searchParams.append(\"limit\", params.limit.toString());\r\n        if (params?.q) searchParams.append(\"q\", params.q);\r\n        return fetchApi(`/technicians?${searchParams.toString()}`, { token });\r\n      },\r\n      create: async (data: CreateTechnicianDTO) => {\r\n        return fetchApi(\"/technicians\", {\r\n          token,\r\n          method: \"POST\",\r\n          body: JSON.stringify(data),\r\n        });\r\n      },\r\n      update: async (id: string, data: Partial<CreateTechnicianDTO>) => {\r\n        return fetchApi(`/technicians/${id}`, {\r\n          token,\r\n          method: \"PATCH\",\r\n          body: JSON.stringify(data),\r\n        });\r\n      },\r\n      getOne: async (id: string) => {\r\n        return fetchApi(`/technicians/${id}`, { token });\r\n      }\r\n    },\r\n    categories: {\r\n      list: async () => {\r\n        return fetchApi(\"/categories\", { token });\r\n      }\r\n    },\r\n    products: {\r\n      list: async (params?: { page?: number; limit?: number; q?: string; categoryId?: string }) => {\r\n        const searchParams = new URLSearchParams();\r\n        if (params?.page) searchParams.append(\"page\", params.page.toString());\r\n        if (params?.limit) searchParams.append(\"limit\", params.limit.toString());\r\n        if (params?.q) searchParams.append(\"q\", params.q);\r\n        if (params?.categoryId) searchParams.append(\"categoryId\", params.categoryId);\r\n        return fetchApi(`/products?${searchParams.toString()}`, { token });\r\n      },\r\n      create: async (data: CreateProductDTO) => {\r\n        return fetchApi(\"/products\", {\r\n          token,\r\n          method: \"POST\",\r\n          body: JSON.stringify(data),\r\n        });\r\n      },\r\n      update: async (id: string, data: Partial<CreateProductDTO>) => {\r\n        return fetchApi(`/products/${id}`, {\r\n          token,\r\n          method: \"PUT\",\r\n          body: JSON.stringify(data),\r\n        });\r\n      },\r\n      getOne: async (id: string) => {\r\n        return fetchApi(`/products/${id}`, { token });\r\n      },\r\n      delete: async (id: string) => {\r\n        return fetchApi(`/products/${id}`, {\r\n          token,\r\n          method: \"DELETE\"\r\n        });\r\n      }\r\n    },\r\n    customers: {\r\n      list: async (params?: { page?: number; limit?: number; search?: string; addressType?: string }) => {\r\n        const searchParams = new URLSearchParams();\r\n        if (params?.page) searchParams.append(\"page\", params.page.toString());\r\n        if (params?.limit) searchParams.append(\"limit\", params.limit.toString());\r\n        if (params?.search) searchParams.append(\"search\", params.search);\r\n        if (params?.addressType && params.addressType !== \"all\") searchParams.append(\"addressType\", params.addressType);\r\n        return fetchApi(`/customers?${searchParams.toString()}`, { token });\r\n      },\r\n      create: async (data: CreateCustomerDTO) => {\r\n        return fetchApi(\"/customers\", {\r\n          token,\r\n          method: \"POST\",\r\n          body: JSON.stringify(data),\r\n        });\r\n      },\r\n      update: async (id: string, data: UpdateCustomerDTO) => {\r\n        return fetchApi(`/customers/${id}`, {\r\n          token,\r\n          method: \"PUT\",\r\n          body: JSON.stringify(data),\r\n        });\r\n      },\r\n      getOne: async (id: string) => {\r\n        return fetchApi(`/customers/${id}`, { token });\r\n      },\r\n      delete: async (id: string) => {\r\n        return fetchApi(`/customers/${id}`, {\r\n          token,\r\n          method: \"DELETE\"\r\n        });\r\n      }\r\n    },\r\n    customerProducts: {\r\n        getByCustomer: async (customerId: string) => {\r\n            return fetchApi(`/customer-products/customer/${customerId}`, { token });\r\n        },\r\n        create: async (data: any) => {\r\n            return fetchApi(\"/customer-products\", {\r\n                token,\r\n                method: \"POST\",\r\n                body: JSON.stringify(data)\r\n            });\r\n        },\r\n        update: async (id: string, data: any) => {\r\n            return fetchApi(`/customer-products/${id}`, {\r\n                token,\r\n                method: \"PATCH\",\r\n                body: JSON.stringify(data)\r\n            });\r\n        },\r\n        getOne: async (id: string) => {\r\n            return fetchApi(`/customer-products/${id}`, { token });\r\n        }\r\n    },\r\n    contracts: {\r\n        list: async (params?: { status?: string, productName?: string }) => {\r\n            const searchParams = new URLSearchParams();\r\n            if (params?.status) searchParams.append(\"status\", params.status);\r\n            if (params?.productName) searchParams.append(\"productName\", params.productName);\r\n            return fetchApi<any[]>(`/contracts?${searchParams.toString()}`, { token });\r\n        },\r\n        getOne: async (id: string) => {\r\n            return fetchApi<any>(`/contracts/${id}`, { token });\r\n        },\r\n        create: async (data: any) => {\r\n            return fetchApi(\"/contracts\", {\r\n                token,\r\n                method: \"POST\",\r\n                body: JSON.stringify(data)\r\n            });\r\n        },\r\n        update: async (id: string, data: any) => {\r\n             return fetchApi(`/contracts/${id}`, {\r\n                token,\r\n                method: \"PATCH\",\r\n                body: JSON.stringify(data)\r\n            });\r\n        },\r\n        delete: async (id: string) => {\r\n            return fetchApi(`/contracts/${id}`, {\r\n                token,\r\n                method: \"DELETE\"\r\n            });\r\n        }\r\n    },\r\n    jobs: {\r\n        list: async (params?: { page?: number; limit?: number; search?: string }) => {\r\n            const searchParams = new URLSearchParams();\r\n            if (params?.page) searchParams.append(\"page\", params.page.toString());\r\n            if (params?.limit) searchParams.append(\"limit\", params.limit.toString());\r\n            if (params?.search) searchParams.append(\"search\", params.search);\r\n            return fetchApi<{ data: any[]; meta: any }>(`/jobs?${searchParams.toString()}`, { token });\r\n        },\r\n        create: async (data: any) => {\r\n            return fetchApi<any>(\"/jobs\", {\r\n                method: \"POST\",\r\n                body: JSON.stringify(data),\r\n                token,\r\n            });\r\n        },\r\n        getOne: async (id: string) => {\r\n            return fetchApi<any>(`/jobs/${id}`, { token });\r\n        },\r\n        update: async (id: string, data: any) => {\r\n            return fetchApi<any>(`/jobs/${id}`, {\r\n                method: \"PUT\",\r\n                body: JSON.stringify(data),\r\n                token,\r\n            });\r\n        },\r\n        delete: async (id: string) => {\r\n            return fetchApi<any>(`/jobs/${id}`, {\r\n                method: \"DELETE\",\r\n                token,\r\n            });\r\n        },\r\n    },\r\n    schedules: {\r\n        list: async (params?: { page?: number; limit?: number; startDate?: string; endDate?: string, status?: string }) => {\r\n            const searchParams = new URLSearchParams();\r\n            if (params?.page) searchParams.append(\"page\", params.page.toString());\r\n            if (params?.limit) searchParams.append(\"limit\", params.limit.toString());\r\n            if (params?.startDate) searchParams.append(\"startDate\", params.startDate);\r\n            if (params?.endDate) searchParams.append(\"endDate\", params.endDate);\r\n            if (params?.status) searchParams.append(\"status\", params.status);\r\n            if ((params as any)?.search) searchParams.append(\"search\", (params as any).search);\r\n            return fetchApi<{ data: any[]; meta: any }>(`/schedules?${searchParams.toString()}`, { token });\r\n        },\r\n        create: async (data: any) => {\r\n            return fetchApi<any>(\"/schedules\", {\r\n                method: \"POST\",\r\n                body: JSON.stringify(data),\r\n                token,\r\n            });\r\n        },\r\n        getOne: async (id: string) => {\r\n            return fetchApi<any>(`/schedules/${id}`, { token });\r\n        },\r\n        update: async (id: string, data: any) => {\r\n            return fetchApi<any>(`/schedules/${id}`, {\r\n                method: \"PUT\",\r\n                body: JSON.stringify(data),\r\n                token,\r\n            });\r\n        },\r\n        delete: async (id: string) => {\r\n            return fetchApi<any>(`/schedules/${id}`, {\r\n                method: \"DELETE\",\r\n                token,\r\n            });\r\n        } // Removed the comma here\r\n    },\r\n    // Keep structure but throw error or require token for others\r\n    // For now, implementing just the auth one requested\r\n    tasks: {\r\n        list: async (params?: { page?: number; limit?: number; status?: string; customerProductId?: string }) => {\r\n            const searchParams = new URLSearchParams();\r\n            if (params?.page) searchParams.append(\"page\", params.page.toString());\r\n            if (params?.limit) searchParams.append(\"limit\", params.limit.toString());\r\n            if (params?.status) searchParams.append(\"status\", params.status);\r\n            if (params?.customerProductId) searchParams.append(\"customerProductId\", params.customerProductId);\r\n            return fetchApi<{ data: any[]; meta: any }>(`/tasks?${searchParams.toString()}`, { token });\r\n        },\r\n        create: async (data: any) => {\r\n            return fetchApi<any>(\"/tasks\", {\r\n                method: \"POST\",\r\n                body: JSON.stringify(data),\r\n                token,\r\n            });\r\n        },\r\n        getOne: async (id: string) => {\r\n            return fetchApi<any>(`/tasks/${id}`, { token });\r\n        },\r\n        update: async (id: string, data: any) => {\r\n            return fetchApi<any>(`/tasks/${id}`, {\r\n                method: \"PUT\",\r\n                body: JSON.stringify(data),\r\n                token,\r\n            });\r\n        },\r\n        delete: async (id: string) => {\r\n            return fetchApi<any>(`/tasks/${id}`, {\r\n                method: \"DELETE\",\r\n                token,\r\n            });\r\n        },\r\n        complete: async (id: string, data: any) => {\r\n             return fetchApi<any>(`/tasks/${id}/complete`, {\r\n                method: \"POST\",\r\n                body: JSON.stringify(data),\r\n                token,\r\n            });\r\n        }\r\n    },\r\n    serviceLogs: {\r\n        update: async (id: string, data: any) => {\r\n            return fetchApi<any>(`/service-logs/${id}`, {\r\n                method: \"PUT\",\r\n                body: JSON.stringify(data),\r\n                token,\r\n            });\r\n        }\r\n    }\r\n  };\r\n};\r\n\r\n// Deprecated static mock client - removing as requested\r\n// Or keeping a shell that throws errors to force migration\r\nexport const api = {\r\n   // Legacy placeholders that warn\r\n   customers: {\r\n       list: () => { throw new Error(\"Use createApiClient(session).customers.list()\") }\r\n   }\r\n};\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 382, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Alexander/webmizu/apps/adminFE/src/components/providers/supabase-provider.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { createContext, useContext, useEffect, useState } from \"react\";\r\nimport { createBrowserClient } from \"@supabase/ssr\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Session, SupabaseClient } from \"@supabase/supabase-js\";\r\nimport { createApiClient } from \"@/src/lib/api/client\";\r\n\r\ninterface SupabaseContextType {\r\n  supabase: SupabaseClient;\r\n  session: Session | null;\r\n  isLoading: boolean;\r\n  profile: any | null; \r\n}\r\n\r\nconst SupabaseContext = createContext<SupabaseContextType | undefined>(undefined);\r\n\r\nexport const SupabaseProvider = ({ children }: { children: React.ReactNode }) => {\r\n  const [supabase] = useState(() => \r\n    createBrowserClient(\r\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n    )\r\n  );\r\n  const [session, setSession] = useState<Session | null>(null);\r\n  const [profile, setProfile] = useState<any | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const router = useRouter();\r\n\r\n  // Initial session check\r\n  useEffect(() => {\r\n    (async () => {\r\n       const { data: { session } } = await supabase.auth.getSession();\r\n       setSession(session);\r\n       if (session) {\r\n          fetchProfile(session);\r\n       }\r\n       setIsLoading(false);\r\n    })();\r\n  }, [supabase]);\r\n\r\n  const fetchProfile = async (currentSession: Session) => {\r\n      try {\r\n          const client = createApiClient(currentSession);\r\n          // @ts-ignore - method exists in our new client\r\n          const res = await client.auth.getMe() as any; \r\n          if (res.success) {\r\n              setProfile(res.data);\r\n              console.log(\"Backend Profile Loaded:\", res.data);\r\n          }\r\n      } catch (e) {\r\n          console.error(\"Failed to load backend profile\", e);\r\n      }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const {\r\n      data: { subscription },\r\n    } = supabase.auth.onAuthStateChange(async (event: string, session: Session | null) => {\r\n      setSession(session);\r\n      setIsLoading(false);\r\n      \r\n      if (event === \"SIGNED_IN\" && session) {\r\n         fetchProfile(session);\r\n         router.refresh();\r\n      }\r\n      if (event === \"SIGNED_OUT\") {\r\n          setProfile(null);\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      subscription.unsubscribe();\r\n    };\r\n  }, [router, supabase]);\r\n\r\n  return (\r\n    <SupabaseContext.Provider value={{ supabase, session, isLoading, profile }}>\r\n      {children}\r\n    </SupabaseContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useSupabase = () => {\r\n  const context = useContext(SupabaseContext);\r\n  if (context === undefined) {\r\n    throw new Error(\"useSupabase must be used within a SupabaseProvider\");\r\n  }\r\n  return context;\r\n};\r\n"],"names":[],"mappings":";;;;;;;AAEA;AACA;AAAA;AACA;AAEA;AANA;;;;;;AAeA,MAAM,gCAAkB,IAAA,yOAAa,EAAkC;AAEhE,MAAM,mBAAmB,CAAC,EAAE,QAAQ,EAAiC;IAC1E,MAAM,CAAC,SAAS,GAAG,IAAA,oOAAQ,EAAC,IAC1B,IAAA,oNAAmB;IAKrB,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,oOAAQ,EAAiB;IACvD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,oOAAQ,EAAa;IACnD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,oOAAQ,EAAC;IAC3C,MAAM,SAAS,IAAA,kKAAS;IAExB,wBAAwB;IACxB,IAAA,qOAAS,EAAC;QACR,CAAC;YACE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU;YAC5D,WAAW;YACX,IAAI,SAAS;gBACV,aAAa;YAChB;YACA,aAAa;QAChB,CAAC;IACH,GAAG;QAAC;KAAS;IAEb,MAAM,eAAe,OAAO;QACxB,IAAI;YACA,MAAM,SAAS,IAAA,iKAAe,EAAC;YAC/B,+CAA+C;YAC/C,MAAM,MAAM,MAAM,OAAO,IAAI,CAAC,KAAK;YACnC,IAAI,IAAI,OAAO,EAAE;gBACb,WAAW,IAAI,IAAI;gBACnB,QAAQ,GAAG,CAAC,2BAA2B,IAAI,IAAI;YACnD;QACJ,EAAE,OAAO,GAAG;YACR,QAAQ,KAAK,CAAC,kCAAkC;QACpD;IACJ;IAEA,IAAA,qOAAS,EAAC;QACR,MAAM,EACJ,MAAM,EAAE,YAAY,EAAE,EACvB,GAAG,SAAS,IAAI,CAAC,iBAAiB,CAAC,OAAO,OAAe;YACxD,WAAW;YACX,aAAa;YAEb,IAAI,UAAU,eAAe,SAAS;gBACnC,aAAa;gBACb,OAAO,OAAO;YACjB;YACA,IAAI,UAAU,cAAc;gBACxB,WAAW;YACf;QACF;QAEA,OAAO;YACL,aAAa,WAAW;QAC1B;IACF,GAAG;QAAC;QAAQ;KAAS;IAErB,qBACE,iQAAC,gBAAgB,QAAQ;QAAC,OAAO;YAAE;YAAU;YAAS;YAAW;QAAQ;kBACtE;;;;;;AAGP;AAEO,MAAM,cAAc;IACzB,MAAM,UAAU,IAAA,sOAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACzB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT"}}]
}