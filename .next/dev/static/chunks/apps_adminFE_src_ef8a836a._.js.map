{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Alexander/webmizu/apps/adminFE/src/lib/api/client.ts"],"sourcesContent":["import { Session } from \"@supabase/supabase-js\";\r\n\r\nconst BACKEND_URL = process.env.NEXT_PUBLIC_BACKEND_URL || \"http://localhost:3000/api/v1\";\r\n\r\ninterface CreateTechnicianDTO {\r\n  name: string;\r\n  phone?: string;\r\n  photo_url?: string;\r\n  notes?: string;\r\n}\r\n\r\ntype ApiOptions = RequestInit & {\r\n  token?: string;\r\n};\r\n\r\nasync function fetchApi<T>(path: string, options: ApiOptions = {}): Promise<T> {\r\n  const { token, headers, ...init } = options;\r\n  \r\n  const reqHeaders = new Headers(headers);\r\n  reqHeaders.set(\"Content-Type\", \"application/json\");\r\n  \r\n  if (token) {\r\n    reqHeaders.set(\"Authorization\", `Bearer ${token}`);\r\n  }\r\n\r\n  const response = await fetch(`${BACKEND_URL}${path}`, {\r\n    ...init,\r\n    headers: reqHeaders,\r\n  });\r\n\r\n  const data = await response.json();\r\n  \r\n  if (!response.ok) {\r\n    throw new Error(data.error?.message || \"An API error occurred\");\r\n  }\r\n\r\n  return data; // Assuming { success: true, data: T } is unwrapped by caller or we return full response?\r\n  // User spec: standard response envelope. Ideally we return the whole envelope or just data?\r\n  // Let's return the full envelope for now to match current return types if any.\r\n}\r\n\r\n// Factory to create a client bound to a session\r\nexport const createApiClient = (session: Session | null) => {\r\n  const token = session?.access_token;\r\n\r\n  return {\r\n    auth: {\r\n      getMe: async () => {\r\n        return fetchApi(\"/auth/me\", { token });\r\n      }\r\n    },\r\n    technicians: {\r\n      list: async (params?: { page?: number; limit?: number; q?: string }) => {\r\n        const searchParams = new URLSearchParams();\r\n        if (params?.page) searchParams.append(\"page\", params.page.toString());\r\n        if (params?.limit) searchParams.append(\"limit\", params.limit.toString());\r\n        if (params?.q) searchParams.append(\"q\", params.q);\r\n        return fetchApi(`/technicians?${searchParams.toString()}`, { token });\r\n      },\r\n      create: async (data: CreateTechnicianDTO) => {\r\n        return fetchApi(\"/technicians\", {\r\n          token,\r\n          method: \"POST\",\r\n          body: JSON.stringify(data),\r\n        });\r\n      },\r\n      update: async (id: string, data: Partial<CreateTechnicianDTO>) => {\r\n        return fetchApi(`/technicians/${id}`, {\r\n          token,\r\n          method: \"PATCH\",\r\n          body: JSON.stringify(data),\r\n        });\r\n      },\r\n      getOne: async (id: string) => {\r\n        return fetchApi(`/technicians/${id}`, { token });\r\n      }\r\n    },\r\n    // Keep structure but throw error or require token for others\r\n    // For now, implementing just the auth one requested\r\n  };\r\n};\r\n\r\n// Deprecated static mock client - removing as requested\r\n// Or keeping a shell that throws errors to force migration\r\nexport const api = {\r\n   // Legacy placeholders that warn\r\n   customers: {\r\n       list: () => { throw new Error(\"Use createApiClient(session).customers.list()\") }\r\n   }\r\n};\r\n"],"names":[],"mappings":";;;;;;AAEoB;AAApB,MAAM,cAAc,oEAAuC;AAa3D,eAAe,SAAY,IAAY,EAAE,UAAsB,CAAC,CAAC;IAC/D,MAAM,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG,MAAM,GAAG;IAEpC,MAAM,aAAa,IAAI,QAAQ;IAC/B,WAAW,GAAG,CAAC,gBAAgB;IAE/B,IAAI,OAAO;QACT,WAAW,GAAG,CAAC,iBAAiB,CAAC,OAAO,EAAE,OAAO;IACnD;IAEA,MAAM,WAAW,MAAM,MAAM,GAAG,cAAc,MAAM,EAAE;QACpD,GAAG,IAAI;QACP,SAAS;IACX;IAEA,MAAM,OAAO,MAAM,SAAS,IAAI;IAEhC,IAAI,CAAC,SAAS,EAAE,EAAE;QAChB,MAAM,IAAI,MAAM,KAAK,KAAK,EAAE,WAAW;IACzC;IAEA,OAAO,MAAM,yFAAyF;AACtG,4FAA4F;AAC5F,+EAA+E;AACjF;AAGO,MAAM,kBAAkB,CAAC;IAC9B,MAAM,QAAQ,SAAS;IAEvB,OAAO;QACL,MAAM;YACJ,OAAO;gBACL,OAAO,SAAS,YAAY;oBAAE;gBAAM;YACtC;QACF;QACA,aAAa;YACX,MAAM,OAAO;gBACX,MAAM,eAAe,IAAI;gBACzB,IAAI,QAAQ,MAAM,aAAa,MAAM,CAAC,QAAQ,OAAO,IAAI,CAAC,QAAQ;gBAClE,IAAI,QAAQ,OAAO,aAAa,MAAM,CAAC,SAAS,OAAO,KAAK,CAAC,QAAQ;gBACrE,IAAI,QAAQ,GAAG,aAAa,MAAM,CAAC,KAAK,OAAO,CAAC;gBAChD,OAAO,SAAS,CAAC,aAAa,EAAE,aAAa,QAAQ,IAAI,EAAE;oBAAE;gBAAM;YACrE;YACA,QAAQ,OAAO;gBACb,OAAO,SAAS,gBAAgB;oBAC9B;oBACA,QAAQ;oBACR,MAAM,KAAK,SAAS,CAAC;gBACvB;YACF;YACA,QAAQ,OAAO,IAAY;gBACzB,OAAO,SAAS,CAAC,aAAa,EAAE,IAAI,EAAE;oBACpC;oBACA,QAAQ;oBACR,MAAM,KAAK,SAAS,CAAC;gBACvB;YACF;YACA,QAAQ,OAAO;gBACb,OAAO,SAAS,CAAC,aAAa,EAAE,IAAI,EAAE;oBAAE;gBAAM;YAChD;QACF;IAGF;AACF;AAIO,MAAM,MAAM;IAChB,gCAAgC;IAChC,WAAW;QACP,MAAM;YAAQ,MAAM,IAAI,MAAM;QAAiD;IACnF;AACH"}},
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Alexander/webmizu/apps/adminFE/src/components/providers/supabase-provider.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { createContext, useContext, useEffect, useState } from \"react\";\r\nimport { createBrowserClient } from \"@supabase/ssr\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { Session, SupabaseClient } from \"@supabase/supabase-js\";\r\nimport { createApiClient } from \"@/src/lib/api/client\";\r\n\r\ninterface SupabaseContextType {\r\n  supabase: SupabaseClient;\r\n  session: Session | null;\r\n  isLoading: boolean;\r\n  profile: any | null; \r\n}\r\n\r\nconst SupabaseContext = createContext<SupabaseContextType | undefined>(undefined);\r\n\r\nexport const SupabaseProvider = ({ children }: { children: React.ReactNode }) => {\r\n  const [supabase] = useState(() => \r\n    createBrowserClient(\r\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!\r\n    )\r\n  );\r\n  const [session, setSession] = useState<Session | null>(null);\r\n  const [profile, setProfile] = useState<any | null>(null);\r\n  const [isLoading, setIsLoading] = useState(true);\r\n  const router = useRouter();\r\n\r\n  // Initial session check\r\n  useEffect(() => {\r\n    (async () => {\r\n       const { data: { session } } = await supabase.auth.getSession();\r\n       setSession(session);\r\n       if (session) {\r\n          fetchProfile(session);\r\n       }\r\n       setIsLoading(false);\r\n    })();\r\n  }, [supabase]);\r\n\r\n  const fetchProfile = async (currentSession: Session) => {\r\n      try {\r\n          const client = createApiClient(currentSession);\r\n          // @ts-ignore - method exists in our new client\r\n          const res = await client.auth.getMe() as any; \r\n          if (res.success) {\r\n              setProfile(res.data);\r\n              console.log(\"Backend Profile Loaded:\", res.data);\r\n          }\r\n      } catch (e) {\r\n          console.error(\"Failed to load backend profile\", e);\r\n      }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const {\r\n      data: { subscription },\r\n    } = supabase.auth.onAuthStateChange(async (event: string, session: Session | null) => {\r\n      setSession(session);\r\n      setIsLoading(false);\r\n      \r\n      if (event === \"SIGNED_IN\" && session) {\r\n         fetchProfile(session);\r\n         router.refresh();\r\n      }\r\n      if (event === \"SIGNED_OUT\") {\r\n          setProfile(null);\r\n      }\r\n    });\r\n\r\n    return () => {\r\n      subscription.unsubscribe();\r\n    };\r\n  }, [router, supabase]);\r\n\r\n  return (\r\n    <SupabaseContext.Provider value={{ supabase, session, isLoading, profile }}>\r\n      {children}\r\n    </SupabaseContext.Provider>\r\n  );\r\n};\r\n\r\nexport const useSupabase = () => {\r\n  const context = useContext(SupabaseContext);\r\n  if (context === undefined) {\r\n    throw new Error(\"useSupabase must be used within a SupabaseProvider\");\r\n  }\r\n  return context;\r\n};\r\n"],"names":[],"mappings":";;;;;;AAoBM;;AAlBN;AACA;AAAA;AACA;AAEA;;;AANA;;;;;AAeA,MAAM,gCAAkB,IAAA,iMAAa,EAAkC;AAEhE,MAAM,mBAAmB,CAAC,EAAE,QAAQ,EAAiC;;IAC1E,MAAM,CAAC,SAAS,GAAG,IAAA,4LAAQ;qCAAC,IAC1B,IAAA,uNAAmB;;IAKrB,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,4LAAQ,EAAiB;IACvD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,4LAAQ,EAAa;IACnD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,4LAAQ,EAAC;IAC3C,MAAM,SAAS,IAAA,qKAAS;IAExB,wBAAwB;IACxB,IAAA,6LAAS;sCAAC;YACR;8CAAC;oBACE,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU;oBAC5D,WAAW;oBACX,IAAI,SAAS;wBACV,aAAa;oBAChB;oBACA,aAAa;gBAChB;aAAC;QACH;qCAAG;QAAC;KAAS;IAEb,MAAM,eAAe,OAAO;QACxB,IAAI;YACA,MAAM,SAAS,IAAA,oKAAe,EAAC;YAC/B,+CAA+C;YAC/C,MAAM,MAAM,MAAM,OAAO,IAAI,CAAC,KAAK;YACnC,IAAI,IAAI,OAAO,EAAE;gBACb,WAAW,IAAI,IAAI;gBACnB,QAAQ,GAAG,CAAC,2BAA2B,IAAI,IAAI;YACnD;QACJ,EAAE,OAAO,GAAG;YACR,QAAQ,KAAK,CAAC,kCAAkC;QACpD;IACJ;IAEA,IAAA,6LAAS;sCAAC;YACR,MAAM,EACJ,MAAM,EAAE,YAAY,EAAE,EACvB,GAAG,SAAS,IAAI,CAAC,iBAAiB;8CAAC,OAAO,OAAe;oBACxD,WAAW;oBACX,aAAa;oBAEb,IAAI,UAAU,eAAe,SAAS;wBACnC,aAAa;wBACb,OAAO,OAAO;oBACjB;oBACA,IAAI,UAAU,cAAc;wBACxB,WAAW;oBACf;gBACF;;YAEA;8CAAO;oBACL,aAAa,WAAW;gBAC1B;;QACF;qCAAG;QAAC;QAAQ;KAAS;IAErB,qBACE,gNAAC,gBAAgB,QAAQ;QAAC,OAAO;YAAE;YAAU;YAAS;YAAW;QAAQ;kBACtE;;;;;;AAGP;GAhEa;;QAUI,qKAAS;;;KAVb;AAkEN,MAAM,cAAc;;IACzB,MAAM,UAAU,IAAA,8LAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACzB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;IANa"}}]
}